{"version":3,"file":"index.js","sources":["../src/js/pixabay-api.js","../src/js/render-functions.js","../src/main.js"],"sourcesContent":["import axios from 'axios';\n\naxios.defaults.baseURL = 'https://pixabay.com';\n\nconst apiKey = \"46140865-1cf24fb63bb06dafc67be25f6\";\n\nexport async function searchImages(searchString, page) {\n\n    const searchParams = new URLSearchParams({\n        key : apiKey,\n        q : searchString,\n        image_type : \"photo\",\n        orientation : \"horizontal\",\n        safesearch : true,\n        page: page,\n        per_page: 15,\n    });\n\n    return await axios.get(`/api/?${searchParams}`);\n}","import SimpleLightbox from \"simplelightbox\";\nimport \"simplelightbox/dist/simple-lightbox.min.css\";\n\nconst lightbox = new SimpleLightbox('.gallery-container a', {\n    captionsData: 'alt',\n    captionDelay: 250,\n});\n\nconst gallery = document.querySelector(\".gallery-container\");\n\nexport function refreshUI(images, reset) {\n\n    const htmlMarkup = images\n    .map((image) => \n        `<li class=\"gallery-item\">\n            <a class=\"gallery-link\" href=\"${image[\"largeImageURL\"]}\">\n                <img class=\"gallery-image\" src=\"${image[\"webformatURL\"]}\" alt=\"${image[\"tags\"]}\" width=\"\"/>\n                <div class=\"small-container\">\n                <div class=\"text-div\"><p class=\"image-info-title\">Likes</p><span class=\"image-info-value\">${image[\"likes\"]}</span></div>\n                <div class=\"text-div\"><p class=\"image-info-title\">Views</p><span class=\"image-info-value\">${image[\"views\"]}</span></div>\n                <div class=\"text-div\"><p class=\"image-info-title\">Comments</p><span class=\"image-info-value\">${image[\"comments\"]}</span></div>\n                <div class=\"text-div\"><p class=\"image-info-title\">Downloads</p><span class=\"image-info-value\">${image[\"downloads\"]}</span></div>\n                </div>\n            </a>\n        </li>`)\n    .join(\"\");\n    \n\n    if(reset == false) {\n        gallery.insertAdjacentHTML(\"beforeend\", htmlMarkup);\n    } else {\n        gallery.innerHTML = htmlMarkup;\n    }\n\n    lightbox.refresh();\n}\n\nexport function clearUI() {\n    gallery.innerHTML = \"\";\n\n    lightbox.refresh();\n}\n\nexport function scrollToPage(page) {\n    if(page == 1) {\n        return;\n    }\n\n    let i = 15 * (page - 1) + 6;\n    let elements = gallery.querySelectorAll('li');\n\n    console.log(elements.length);\n\n    if(elements.length < i) {\n       return;\n    }\n    \n    let elementRect = elements[i].getBoundingClientRect();\n\n    console.log(elementRect);\n\n    window.scrollBy({\n        top: elementRect.top,\n        left: 0,\n        behavior: \"smooth\",\n    });\n}\n\n\n\n\n// 1. Делаем addEventListener по клику\n// 2. При каждом нажатии кнопки приходит 15 изображений на экран\n//    - Значение в инпуте форма запоминает\n//    - Начальное значение параметра page=1. Следующее +=1\n// 3. После - появляется кнопка внизу экрана с названием Load more. До этого \n//  кнопка скрыта и не появляется, пока форма не загрузится до конца.\n// 5. Под Load more появляется индикатор загрузки.\n// 6. При изменении запроса - page снова =1\n\n\n// 1. Бекэнд возвращает переменную totalHits с количеством изображений.\n// 2. Когда коллекция закончилась, прячется кнопка Load more и появляется Alert\n//  с текстом \"We're sorry, but you've reached the end of search results.\"\n\n\n//  -Прокрутка страницы-\n// 1. Плавная прокрутка после загрузки страницы.\n//   - Для этого получаем высоту каждой карточки в функции  getBoundingClientRect\n//   - Используем метод  window.scrollBy  на две высоты карты галлереи.","import iziToast from \"izitoast\";\nimport \"izitoast/dist/css/iziToast.min.css\";\n\nimport { searchImages } from \"./js/pixabay-api.js\";\n\nimport { refreshUI, clearUI, scrollToPage } from \"./js/render-functions.js\";\n\nconst form = document.querySelector(`form`);\nconst loader = document.querySelector(`.loader-container`);\nconst btnLoadMore = document.querySelector(`.btn-load-more`);\nconst endOfGallery = document.querySelector(`.end-of-gallery`);\nlet searchString = \"\";\nlet currentPage = 0;\nlet totalHits = 0;\nlet loadedItems = 0;\n\nwindow.addEventListener(\"load\", (event) => {\n    \n    btnLoadMore.style.display = `none`;\n    endOfGallery.style.display = `none`;\n\n    console.log(\"page is fully loaded\");\n});\n\nform.addEventListener(\"submit\", event => {\n    event.preventDefault();\n    \n    const searchValue = form.elements.search.value.trim();\n    if(searchValue === \"\"){\n        return \n    }\n\n    searchString = searchValue;\n    currentPage = 1;\n\n    loadImages(searchValue, currentPage, true);\n\n})\n\nbtnLoadMore.addEventListener(\"click\", event => {\n    event.preventDefault();\n    console.log(btnLoadMore);\n\n    currentPage += 1;\n\n    loadImages(searchString, currentPage, false);\n})\n\nfunction loadImages(searchString, page, reset) {\n\n    loader.style.display = 'flex';\n    btnLoadMore.style.display = `none`;\n\n    if(reset == true){\n        clearUI();\n        loadedItems = 0;\n    }\n\n    searchImages(searchString, page)\n\n    .then((jsonImages) => {\n\n        const images = jsonImages[\"data\"][\"hits\"];\n        totalHits = jsonImages[\"data\"][\"totalHits\"];\n        loadedItems += images.length;\n\n        console.log(jsonImages);\n\n        if(loadedItems >= totalHits) {\n            btnLoadMore.style.display = `none`;\n            endOfGallery.style.display = `flex`;\n        } else {\n            btnLoadMore.style.display = `block`;\n            endOfGallery.style.display = `none`;\n        }\n\n        if(images.length === 0) {\n            iziToast.info({\n                title: \"Info\",\n                message: \"Sorry, there are no images matching your search query. Please try again!\"\n            });\n        } else {\n            refreshUI(images, reset);\n            scrollToPage(currentPage);\n        }\n    })\n    .catch((error) => {\n        console.log(error);\n    })\n    .finally(() => {\n        loader.style.display = `none`;\n    })\n\n}"],"names":["axios","apiKey","searchImages","searchString","page","searchParams","lightbox","SimpleLightbox","gallery","refreshUI","images","reset","htmlMarkup","image","clearUI","scrollToPage","i","elements","elementRect","form","loader","btnLoadMore","endOfGallery","currentPage","totalHits","loadedItems","event","searchValue","loadImages","jsonImages","iziToast","error"],"mappings":"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"}